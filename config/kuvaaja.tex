% Ympäristö kuvaajan plottaamiseen. Käytä jos riittää jotta on helppo päivittää.
% Käyttö:
% \begin{kuvaajapohja}{2}{-3.14}{3.14}{-1.25}{1.25}
% 	\kuvaaja{sin(x)}{hassu kuvaaja}{red}
% 	\kuvaaja{cos(x)}{hassumpi kuvaaja}{blue}
% \end{kuvaajapohja}
% piirtää punaisen sinin ja sinisen kosinin välille -3.14 .. 3.14,
% y-koordinaatti välillä -1.25 .. 1.25, sinin nimenä hassu kuvaaja
% ja kosinin nimenä hassumpi kuvaaja, skaalattuna kertoimella 2.


% kuvaajapohja-ympäristön parametrit: skaala minx maxx miny maxy
\newenvironment{kuvaajapohja}[5]
{
	\begin{tikzpicture}
		\pgfmathsetmacro{\kuvaajasmallgrid}{0.25}
		\pgfmathsetmacro{\kuvaajastep}{1}
		\ifthenelse{\lengthtest{#1 pt < 0.8 pt}}{
			\pgfmathsetmacro{\kuvaajasmallgrid}{0.5}
		}{}
		\ifthenelse{\lengthtest{#1 pt < 0.4 pt}}{
			\pgfmathsetmacro{\kuvaajasmallgrid}{1}
			\pgfmathsetmacro{\kuvaajastep}{2}
		}{}
		
		\draw[color=black!10!white, step=#1*\kuvaajasmallgrid] (#1*#2, #1*#4) grid (#1*#3, #1*#5);
		\draw[color=black!50!white, step=#1] (#1*#2, #1*#4) grid (#1*#3, #1*#5);
		\draw[arrows=-triangle 45, thick] (#1*#2,0) -- (#1*#3,0);
		\draw[arrows=-triangle 45, thick] (0,#1*#4) -- (0,#1*#5);
		
		\pgfmathsetmacro{\xalaraja}{-#2-0.01}
		\pgfmathsetmacro{\xylaraja}{#3-0.01}
		\pgfmathsetmacro{\yalaraja}{-#4-0.01}
		\pgfmathsetmacro{\yylaraja}{#5-0.01}
		\foreach \sarake in {0,...,\xylaraja}
		{
			\ifthenelse{\lengthtest{\sarake pt > 0 pt}}{
				\pgfmathsetmacro{\kuvaajajakojaannos}{mod(\sarake, \kuvaajastep)}
				\ifthenelse{\lengthtest{\kuvaajajakojaannos pt = 0 pt}}{
					\draw (#1*\sarake + 0.1, 0) node[above] {\footnotesize\sarake};
					\draw[thick] (#1*\sarake, -0.07) -- (#1*\sarake, 0.07);
				}{}
			}{}
		}
		\foreach \sarake in {0,...,\xalaraja}
		{
			\ifthenelse{\lengthtest{\sarake pt > 0 pt}}{
				\pgfmathsetmacro{\kuvaajajakojaannos}{mod(\sarake, \kuvaajastep)}
				\ifthenelse{\lengthtest{\kuvaajajakojaannos pt = 0 pt}}{
					\draw (-#1*\sarake + 0.1, 0) node[above] {\footnotesize\sarake};
					\draw[thick] (-#1*\sarake, -0.07) -- (-#1*\sarake, 0.07);
				}{}
			}{}
		}
		\foreach \rivi in {0,...,\yylaraja}
		{
			\ifthenelse{\lengthtest{\rivi pt > 0 pt}}{
				\pgfmathsetmacro{\kuvaajajakojaannos}{mod(\rivi, \kuvaajastep)}
				\ifthenelse{\lengthtest{\kuvaajajakojaannos pt = 0 pt}}{
					\draw (0, #1*\rivi) node[right] {\footnotesize\rivi};
					\draw[thick] (-0.07, #1*\rivi) -- (0.07, #1*\rivi);
				}{}
			}{}
		}
		\foreach \rivi in {0,...,\yalaraja}
		{
			\ifthenelse{\lengthtest{\rivi pt > 0 pt}}{
				\pgfmathsetmacro{\kuvaajajakojaannos}{mod(\rivi, \kuvaajastep)}
				\ifthenelse{\lengthtest{\kuvaajajakojaannos pt = 0 pt}}{
					\draw (0, -#1*\rivi) node[right] {\footnotesize\rivi};
					\draw[thick] (-0.07, -#1*\rivi) -- (0.07, -#1*\rivi);
				}{}
			}{}
		}
%		\draw (#1, 0) node[above] {1};
%		\draw (0, #1) node[right] {1};
		\newcommand\kuvaajascale{#1}
		\newcommand\kuvaajaminx{#2}
		\newcommand\kuvaajamaxx{#3}
		\newcommand\kuvaajaminy{#4}
		\newcommand\kuvaajamaxy{#5}
}
{
	\end{tikzpicture}
}

% kuvaaja-komennon parametrit: funktio(x) nimi väri
\newcommand{\kuvaaja}[3]{
	\draw[smooth,color=#3,thick,domain=\kuvaajaminx:\kuvaajamaxx,scale=\kuvaajascale,samples=300] plot function{(#1) < \kuvaajamaxy ? ((#1) > \kuvaajaminy ? (#1) : NaN) : NaN} node[right] {#2};
}

% Piirtää pisteen kuvaajaan. Parametrit:
% x y
\newcommand{\kuvaajapiste}[2]{
	\fill (#1*\kuvaajascale, #2*\kuvaajascale) circle (0.07);
}
